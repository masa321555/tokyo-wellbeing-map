# 混雑度推定機能デモ手順

## 概要
Google Places APIのPopular Timesが新しいAPIで利用できないため、独自の混雑度推定モデルを実装しました。
エリアの特性（主要駅の有無、人口密度、施設密度、公園の数など）から混雑度を推定します。

## 1. 混雑度APIの動作確認

### 単一エリアの混雑度取得
```bash
# 千代田区の混雑度を取得
curl http://localhost:8000/api/v1/congestion/area/1 | python3 -m json.tool
```

### レスポンス例
```json
{
  "area": {
    "id": 1,
    "name": "千代田区",
    "population_density": 5746.14
  },
  "congestion": {
    "overall": {
      "score": 59.3,
      "level": {
        "level": "moderate",
        "label": "普通",
        "color": "#FFAA00",
        "description": "適度な賑わいがあり、便利な生活が送れます"
      }
    },
    "time_based": {
      "weekday": 64.3,
      "weekend": 54.3,
      "morning": 69.3,
      "daytime": 59.3,
      "evening": 67.3
    },
    "facility_based": {
      "station": 90.0,
      "shopping": 63.6,
      "park": 29.3,
      "residential": 49.3
    },
    "family_metrics": {
      "family_friendliness": 40.7,
      "stroller_accessibility": 28.9,
      "quiet_area_ratio": 30.0
    }
  }
}
```

## 2. 混雑度レベルの説明

### レベル分類
- **非常に混雑**（80以上）: 常に混雑しており、移動に時間がかかる
- **混雑**（60-79）: 混雑していますが、生活には支障ありません
- **普通**（40-59）: 適度な賑わいがあり、便利な生活が送れます
- **空いている**（20-39）: ゆったりとした環境で、子育てに適しています
- **非常に空いている**（20未満）: 静かな環境で、のびのびと生活できます

### 推定要因
1. **主要駅の有無**: 新宿、渋谷、池袋などの主要駅がある区は基本混雑度が高い
2. **人口密度**: 人口密度が高いほど混雑度が上昇
3. **施設密度**: 商業施設、娯楽施設が多いほど混雑度が上昇
4. **公園の数**: 公園が多いと混雑度が緩和される

## 3. フロントエンドでの表示確認

### エリア詳細ページ
1. ブラウザで http://localhost:3001 を開く
2. 地図から任意の区をクリック
3. エリア詳細ページの下部に「混雑度情報」セクションが表示される

### 表示内容
- **総合混雑度**: スコアとレベル表示
- **時間帯別混雑度**: 朝、昼間、夕方、平日、週末の混雑度
- **施設タイプ別混雑度**: 駅周辺、商業施設、公園、住宅地の混雑度
- **ファミリー向け指標**: 
  - 子育て環境スコア（100 - 混雑度）
  - ベビーカーアクセシビリティ
  - 静かなエリアの割合

## 4. 複数エリアの比較

```bash
# 千代田区、港区、新宿区の混雑度を比較
curl "http://localhost:8000/api/v1/congestion/compare?area_ids=1,3,4" | python3 -m json.tool
```

### レスポンス例
```json
{
  "comparisons": [
    {
      "area": {"id": 1, "name": "千代田区"},
      "congestion": {
        "overall": 59.3,
        "family_friendliness": 40.7,
        "level": {"label": "普通"}
      }
    },
    {
      "area": {"id": 3, "name": "港区"},
      "congestion": {
        "overall": 78.6,
        "family_friendliness": 21.4,
        "level": {"label": "混雑"}
      }
    }
  ],
  "best_for_families": "千代田区"
}
```

## 5. 全区の混雑度更新

```bash
# 全23区の混雑度を一括更新
curl -X POST http://localhost:8000/api/v1/congestion/update-all
```

## 注意事項

1. **推定モデルの精度**
   - 実際の混雑度データではなく、エリアの特性から推定した値です
   - 主要駅の有無を重要な要因として使用しています
   - 将来的には実際の人流データと組み合わせることで精度向上が可能です

2. **ファミリー向け指標**
   - 混雑度が低いほど子育てに適していると判定
   - ベビーカーでの移動しやすさを考慮
   - 公園の多さが静かなエリアの指標として使用

3. **改善案**
   - Google Maps Platform の他のAPIを活用
   - 東京都の人流オープンデータがあれば連携
   - ユーザーからのフィードバックを収集して精度向上