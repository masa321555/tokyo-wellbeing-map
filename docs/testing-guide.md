# 東京ウェルビーイング居住地マップ - 動作テストガイド

## 1. 環境セットアップ

### 1.1 必要なソフトウェアの確認

```bash
# Node.jsのバージョン確認（18以上が必要）
node --version

# Pythonのバージョン確認（3.11以上が必要）
python --version

# npmのバージョン確認
npm --version
```

### 1.2 プロジェクトのセットアップ

#### ステップ1: リポジトリのクローン（既にある場合はスキップ）
```bash
cd /Users/mitsuimasaharu/Documents/CLI_CODE/tochijihai/tokyo-wellbeing-map
```

#### ステップ2: バックエンドのセットアップ
```bash
# バックエンドディレクトリに移動
cd backend

# Python仮想環境の作成
python -m venv venv

# 仮想環境の有効化
source venv/bin/activate  # Mac/Linux
# Windows: venv\Scripts\activate

# 依存関係のインストール
pip install -r requirements.txt

# 環境変数ファイルの作成
cp .env.example .env

# データベースの初期化（重要！）
python -m app.database.init_db
```

#### ステップ3: フロントエンドのセットアップ
```bash
# フロントエンドディレクトリに移動
cd ../frontend

# 依存関係のインストール
npm install

# 環境変数ファイルの確認
# .env.localが存在することを確認
```

## 2. アプリケーションの起動

### 2.1 2つのターミナルを開いて実行

#### ターミナル1: バックエンドの起動
```bash
cd backend
source venv/bin/activate  # 仮想環境を有効化
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

成功すると以下のようなメッセージが表示されます：
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using StatReload
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

#### ターミナル2: フロントエンドの起動
```bash
cd frontend
npm run dev
```

成功すると以下のようなメッセージが表示されます：
```
   ▲ Next.js 14.x.x
   - Local:        http://localhost:3000
   - Environments: .env.local

 ✓ Ready in xs
```

## 3. 動作確認チェックリスト

### 3.1 バックエンドの確認

1. **APIドキュメントの確認**
   - ブラウザで http://localhost:8000/docs にアクセス
   - Swagger UIが表示されることを確認
   - 各エンドポイントが表示されていることを確認

2. **APIの動作テスト**
   ```bash
   # エリア一覧の取得テスト
   curl http://localhost:8000/api/v1/areas
   
   # 正常にJSONデータが返ってくることを確認
   ```

### 3.2 フロントエンドの確認

1. **ホームページ**
   - ブラウザで http://localhost:3000 にアクセス
   - ページが正常に表示されることを確認

2. **機能テスト**

#### A. エリア一覧表示
- [ ] エリアカードが表示される
- [ ] 各エリアのウェルビーイングスコアが表示される
- [ ] 地図表示/リスト表示の切り替えができる

#### B. 検索・フィルタリング
- [ ] 家賃範囲のスライダーが動作する
- [ ] 間取りの選択ができる
- [ ] 検索ボタンで結果が更新される
- [ ] リセットボタンで条件がクリアされる

#### C. ウェルビーイング重み設定
- [ ] 「ランキング」タブに切り替えられる
- [ ] 各カテゴリの重みスライダーが動作する
- [ ] プリセットボタンが機能する
- [ ] 合計が100%になるよう自動調整される

#### D. エリア詳細
- [ ] エリアカードの「詳細を見る」ボタンが機能する
- [ ] 詳細ページでレーダーチャートが表示される
- [ ] 各種統計データが表示される

#### E. エリア比較
- [ ] エリアを選択できる（チェックボックス）
- [ ] 選択したエリアが左サイドバーに表示される
- [ ] 「比較する」ボタンで比較ページに遷移する
- [ ] 比較ページでレーダーチャートが表示される

#### F. 家計シミュレーション
- [ ] シミュレーションページにアクセスできる
- [ ] フォームに入力できる
- [ ] シミュレーション実行で結果が表示される
- [ ] 円グラフが正しく表示される

## 4. トラブルシューティング

### 4.1 よくある問題と解決方法

#### データが表示されない場合
```bash
# バックエンドのログを確認
# データベースが初期化されているか確認
cd backend
python -m app.database.init_db
```

#### CORSエラーが発生する場合
- backend/.envファイルでCORS設定を確認
```
BACKEND_CORS_ORIGINS=["http://localhost:3000"]
```

#### ポートが使用中の場合
```bash
# 8000番ポートを使用しているプロセスを確認
lsof -i :8000
# プロセスを終了
kill -9 [PID]

# 3000番ポートも同様
lsof -i :3000
kill -9 [PID]
```

#### 地図が表示されない場合
- Leafletの地図が正しく表示されるか確認
- ブラウザのコンソールでエラーを確認

### 4.2 ログの確認方法

#### バックエンドログ
- ターミナル1でリアルタイムに表示される
- エラーや警告を確認

#### フロントエンドログ
- ターミナル2でビルドエラーを確認
- ブラウザの開発者ツール（F12）でコンソールエラーを確認

## 5. パフォーマンステスト

### 5.1 レスポンス時間の確認
- ブラウザの開発者ツール > Network タブ
- 各APIリクエストの応答時間を確認
- 目標: 1秒以内

### 5.2 負荷テスト（オプション）
```bash
# Apache Benchを使用した簡易負荷テスト
ab -n 100 -c 10 http://localhost:8000/api/v1/areas
```

## 6. テスト完了チェックリスト

- [ ] バックエンドが正常に起動する
- [ ] フロントエンドが正常に起動する
- [ ] データベースにサンプルデータが投入されている
- [ ] 全てのページにアクセスできる
- [ ] 主要機能が動作する
- [ ] エラーが発生していない
- [ ] レスポンス時間が許容範囲内

## 7. 次のステップ

テストが完了したら：
1. 実際の東京都オープンデータを取得して投入
2. Mapboxトークンを取得して地図機能を強化
3. 本番環境へのデプロイ準備