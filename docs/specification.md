# 東京ウェルビーイング居住地マップ - アプリケーション仕様書

## 1. 概要

### 1.1 プロジェクト概要
- **名称**: 東京ウェルビーイング居住地マップ
- **目的**: 子育て世代（30〜40代）が東京都内で「自分の価値観に合った居住地」を納得して選べるよう支援する
- **対象ユーザー**: 30〜40代の子育て世代（小・中学生の子を持つ家庭）

### 1.2 主要機能
1. 東京都23区の生活環境データの可視化
2. ユーザーの価値観に基づくウェルビーイング・スコアの算出
3. 複数エリアの比較機能
4. 家計シミュレーション機能
5. インタラクティブな地図表示

## 2. システム構成

### 2.1 技術スタック

#### フロントエンド
- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **UIライブラリ**: React 18
- **スタイリング**: Tailwind CSS
- **状態管理**: Zustand
- **地図表示**: Leaflet / react-leaflet
- **グラフ表示**: Recharts
- **UIコンポーネント**: Radix UI

#### バックエンド
- **フレームワーク**: FastAPI
- **言語**: Python 3.11+
- **ORM**: SQLAlchemy
- **データベース**: SQLite（開発）/ PostgreSQL（本番推奨）
- **データ処理**: Pandas, GeoPandas
- **非同期処理**: asyncio

#### インフラ・外部サービス
- **データソース**: 東京都オープンデータカタログ (CKAN API)
- **地図タイル**: OpenStreetMap
- **ホスティング**: GCP / AWS（想定）

### 2.2 システムアーキテクチャ

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   フロントエンド  │────▶│   バックエンド    │────▶│   データベース   │
│   (Next.js)     │     │   (FastAPI)     │     │   (SQLite)      │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                               │
                               ▼
                        ┌─────────────────┐
                        │ 東京都オープン   │
                        │ データAPI       │
                        └─────────────────┘
```

## 3. 機能仕様

### 3.1 エリア検索・一覧表示

#### 3.1.1 検索条件
- **家賃範囲**: スライダーで最小・最大値を設定
- **間取り**: 1R〜3LDKから選択
- **教育環境**: 小学校数（最小）、待機児童数（最大）
- **公園**: 公園数（最小）
- **治安**: 犯罪率（最大）

#### 3.1.2 表示方法
- **リスト表示**: カード形式でエリア情報を表示
- **地図表示**: インタラクティブマップ上にマーカーで表示
- **切り替え**: ワンクリックで表示方法を切り替え可能

### 3.2 ウェルビーイング・スコア

#### 3.2.1 評価カテゴリと重み
| カテゴリ | デフォルト重み | 説明 |
|---------|--------------|------|
| 家賃・住居費 | 25% | 家賃の手頃さ |
| 治安・安全性 | 20% | 犯罪率の低さ、防犯設備 |
| 教育環境 | 20% | 学校数、待機児童、図書館 |
| 公園・緑地 | 15% | 公園数、一人当たり面積 |
| 医療・福祉 | 10% | 病院数、小児科、救急対応 |
| 文化・施設 | 10% | 文化施設、スポーツ施設 |

#### 3.2.2 スコア算出ロジック
- 各カテゴリを0-100点で評価
- ユーザーが設定した重みで加重平均を計算
- 総合スコアを算出（0-100点）

#### 3.2.3 プリセット設定
- **バランス重視**: 全項目を均等に評価
- **子育て重視**: 教育と安全性を重視
- **コスト重視**: 家賃の安さを最優先
- **健康・ウェルネス重視**: 公園と医療環境を重視

### 3.3 エリア詳細表示

#### 3.3.1 基本情報
- エリア名、人口、面積、人口密度
- 総合ウェルビーイングスコア
- カテゴリ別スコア（レーダーチャート）

#### 3.3.2 詳細データ
- **住宅情報**: 間取り別家賃相場、空き家率
- **教育環境**: 学校数、保育園数、待機児童数
- **公園・緑地**: 公園数、一人当たり面積、児童公園数
- **治安**: 犯罪率、交番数、防犯カメラ数
- **医療**: 病院数、小児科数、救急病院数
- **文化施設**: 図書館、美術館、スポーツ施設数

### 3.4 エリア比較機能

#### 3.4.1 比較方法
- 最大5エリアまで同時比較可能
- レーダーチャートで視覚的に比較
- 詳細データを表形式で比較

#### 3.4.2 比較項目
- ウェルビーイングスコア（総合・カテゴリ別）
- 基本情報（人口、面積等）
- 各種施設数、家賃相場等

### 3.5 家計シミュレーション

#### 3.5.1 入力項目
- **家族構成**: 大人の人数、子供の人数
- **世帯年収**: 年収（万円）
- **間取り**: 希望する間取り
- **通勤先**: 主要駅から選択
- **オプション**: 車の所有、保育園利用

#### 3.5.2 シミュレーション結果
- **月間支出内訳**: 円グラフで表示
  - 家賃
  - 光熱費
  - 食費
  - 通信費
  - 交通費
  - 教育費
  - その他
- **可処分所得**: 月間の余剰金額
- **貯蓄率**: 収入に対する貯蓄可能額の割合
- **住居費負担度**: 100点満点で評価
- **アドバイス**: 家計改善のための提案

### 3.6 データ管理

#### 3.6.1 データソース
- 東京都オープンデータカタログ (CKAN API)
- 定期的な自動更新（24時間ごと）

#### 3.6.2 データカテゴリ
| カテゴリ | データ項目 | 更新頻度 |
|---------|-----------|---------|
| 不動産価格・家賃 | 間取り別平均家賃、売買価格 | 月次 |
| 公園・緑地 | 公園数、面積、設備情報 | 年次 |
| 教育施設 | 学校数、保育園情報、待機児童数 | 年次 |
| 治安 | 犯罪統計、防犯設備数 | 年次 |
| 医療・福祉 | 医療機関数、診療科目別統計 | 年次 |
| 文化施設 | 図書館、美術館、スポーツ施設 | 年次 |
| 子育て支援 | 支援制度、補助金情報 | 年次 |

## 4. データベース設計

### 4.1 主要テーブル

#### areas（エリア基本情報）
- id: 主キー
- code: 区市コード
- name: 区市名
- name_kana: 区市名かな
- center_lat: 中心緯度
- center_lng: 中心経度
- area_km2: 面積
- population: 人口
- households: 世帯数

#### housing_data（住宅データ）
- area_id: 外部キー
- rent_1r〜rent_3ldk: 間取り別家賃
- price_per_sqm: 売買価格
- vacant_rate: 空き家率

#### park_data（公園データ）
- area_id: 外部キー
- total_parks: 公園総数
- total_area_sqm: 総面積
- parks_per_capita: 一人当たり面積
- children_parks: 児童公園数

#### school_data（学校データ）
- area_id: 外部キー
- elementary_schools: 小学校数
- junior_high_schools: 中学校数
- high_schools: 高等学校数

#### safety_data（治安データ）
- area_id: 外部キー
- total_crimes: 総犯罪件数
- crime_rate_per_1000: 犯罪率
- police_boxes: 交番数

#### medical_data（医療データ）
- area_id: 外部キー
- hospitals: 病院数
- pediatric_clinics: 小児科数
- emergency_hospitals: 救急病院数

#### culture_data（文化施設データ）
- area_id: 外部キー
- libraries: 図書館数
- museums: 美術館・博物館数
- sports_facilities: スポーツ施設数

#### childcare_data（子育て支援データ）
- area_id: 外部キー
- nursery_schools: 保育園数
- waiting_children: 待機児童数
- childcare_subsidy_max: 保育料補助上限

## 5. API仕様

### 5.1 エンドポイント一覧

#### エリア関連
- `GET /api/v1/areas` - エリア一覧取得
- `GET /api/v1/areas/{area_id}` - エリア詳細取得
- `POST /api/v1/areas/compare` - エリア比較

#### ウェルビーイング関連
- `POST /api/v1/wellbeing/calculate` - スコア計算
- `POST /api/v1/wellbeing/ranking` - ランキング取得
- `POST /api/v1/wellbeing/recommend` - レコメンド取得
- `GET /api/v1/wellbeing/weights/presets` - プリセット取得

#### 検索関連
- `POST /api/v1/search/` - エリア検索
- `GET /api/v1/search/suggestions` - 検索候補取得

#### シミュレーション関連
- `POST /api/v1/simulation/household` - 家計シミュレーション
- `POST /api/v1/simulation/lifestyle` - 生活変化シミュレーション
- `GET /api/v1/simulation/commute-time` - 通勤時間推定

#### オープンデータ関連
- `GET /api/v1/opendata/datasets` - データセット一覧
- `GET /api/v1/opendata/categories` - カテゴリ一覧
- `POST /api/v1/opendata/update` - データ更新トリガー

## 6. 画面構成

### 6.1 画面一覧
1. **ホーム画面**: 検索・ランキング表示
2. **エリア詳細画面**: 個別エリアの詳細情報
3. **比較画面**: 複数エリアの比較
4. **シミュレーション画面**: 家計シミュレーション

### 6.2 画面遷移
```
ホーム画面
  ├─→ エリア詳細画面
  ├─→ 比較画面
  └─→ シミュレーション画面
```

## 7. 非機能要件

### 7.1 パフォーマンス
- 検索結果表示: 3秒以内
- 地図表示: 2秒以内
- API応答時間: 1秒以内（95パーセンタイル）

### 7.2 セキュリティ
- HTTPS通信必須
- APIキーによる認証（外部API）
- 個人情報は保存しない

### 7.3 可用性
- 稼働率: 99.0%以上（目標）
- データ更新: 24時間ごと

### 7.4 互換性
- ブラウザ: Chrome, Firefox, Safari, Edge（最新2バージョン）
- デバイス: デスクトップ、タブレット、スマートフォン
- レスポンシブデザイン対応

## 8. 今後の拡張予定

### 8.1 機能拡張
- ユーザーアカウント機能
- お気に入りエリア保存
- 検索条件保存
- 通知機能（条件に合うエリアの新着情報）

### 8.2 データ拡張
- 東京都以外のエリア対応
- リアルタイム交通情報連携
- 不動産物件情報連携
- 口コミ・レビュー機能

### 8.3 AI機能強化
- より高度な推薦アルゴリズム
- 自然言語での検索対応
- チャットボットによる相談機能