#!/usr/bin/env python3
"""
各区の特徴データをMongoDBに保存するスクリプト
"""
import asyncio
import sys
import os
from pathlib import Path

# プロジェクトルートを追加
sys.path.append(str(Path(__file__).parent.parent.parent))

from motor.motor_asyncio import AsyncIOMotorClient
from beanie import init_beanie
from app.models_mongo.area import Area, AreaCharacteristics
from dotenv import load_dotenv

# 環境変数を読み込み
load_dotenv('.env.mongo')

# 各区の特徴データ（提供されたファイルから抽出）
AREA_CHARACTERISTICS = {
    "千代田区": {
        "medical_childcare": "医療機関多数（大病院集中）。皇居周辺に緑地が広がり都心でも環境良好。",
        "education_culture": "皇居（江戸城址）や靖国神社など歴史的施設が所在し伝統を感じる。",
        "livability": "丸の内・大手町など日本のビジネス中心地。昼間人口が多く経済活動の拠点。人口が少なく治安は良好で落ち着いた街。夜間は静かで、ビジネス街ゆえ居住者コミュニティは小規模。"
    },
    "中央区": {
        "medical_childcare": "聖路加国際病院など高度医療施設あり。隅田川や東京湾に面し水辺の環境を享受。",
        "education_culture": "日本橋・銀座など老舗や歌舞伎座があり商都の伝統と文化施設が共存。",
        "livability": "日本屈指の商業エリア（銀座・日本橋）で企業も多数。物価・家賃は高め。昼夜問わず人通り多いが居住人口は少なめ。商業従事者中心で「遊びに行く街」のイメージが強い。"
    },
    "港区": {
        "medical_childcare": "虎の門病院など大病院充実。臨海部再開発で公園・緑地も整備。",
        "education_culture": "大使館が密集し国際色豊か。東京タワーや増上寺など観光名所多数。",
        "livability": "本社企業数トップクラスで高所得層多い。IT・外資系企業も集積し経済力大。富裕層・外国人住民が多い。治安は概ね良好だが繁華街では注意も必要。高級志向の落ち着いた生活環境。"
    },
    "新宿区": {
        "medical_childcare": "新宿駅周辺に医療施設集中（区立医療センター等）。新宿御苑など大公園もあり環境の潤い。",
        "education_culture": "花街やコリアタウンなど多文化共生の街。国内最大級の繁華街・劇場街を抱える。",
        "livability": "超高層ビル群のオフィス街と歌舞伎町など歓楽街が共存。商業・サービス業中心。常に活気があり人口密集。歌舞伎町等一部治安注意エリアあり。多様性が高く国際色豊か。"
    },
    "文京区": {
        "medical_childcare": "東大病院など大学病院多数。緑地も多く教育環境良好で空気も比較的きれい。",
        "education_culture": "文教地区として有名（東京大学など）で、夏目漱石ゆかりの地など文化的遺産が点在。",
        "livability": "大企業は少なく教育・研究機関中心。住宅街が広がり物価は都心比で中程度。閑静で治安が非常に良い。繁華街が少なくファミリー層が安心して暮らせる環境。"
    },
    "台東区": {
        "medical_childcare": "上野恩賜公園など広大な公園があり都市のオアシス。個人病院中心だが身近な医療は充実。",
        "education_culture": "浅草・上野を擁し「古き良き大衆文化」の薫る下町。祭りや芸能など伝統行事が豊富。",
        "livability": "中小商店や卸売市場が集積した庶民的商業地。家賃相場は23区内で低め。観光客も多い下町で人情味が濃い。昼間から交流できる酒場も多く、地元住民同士の結びつきが強い。"
    },
    "墨田区": {
        "medical_childcare": "区内に総合病院あり。隅田川沿いで水と緑を身近に感じる。工場減少で大気環境は改善傾向。",
        "education_culture": "相撲の街（両国国技館）として有名。葛飾北斎ゆかりの地で江戸伝統文化も息づく。",
        "livability": "東京スカイツリー開業で観光・商業活性化。地元中小企業も多く製造業の伝統あり。下町情緒と新しい観光地が混在。近年単身者に人気上昇中で若い住民も増加。"
    },
    "江東区": {
        "medical_childcare": "湾岸部の埋立地開発で広い公園や運河沿い歩道整備。臨海部に最新医療センター開設。",
        "education_culture": "下町と港湾文化が交錯（門前仲町の祭りなど）。豊洲市場移転で話題の地域。",
        "livability": "大規模マンション林立し人口増。IT企業本社も多く新産業拠点に。新旧住民が混在。下町の絆と新住民の交流が進む。門前仲町等は安く美味しい飲食街が賑わい生活利便性高。"
    },
    "品川区": {
        "medical_childcare": "区南部に東京湾岸エリア。大井埠頭中央海浜公園など埋立地に広い緑地あり。医療は済生会病院等。",
        "education_culture": "東海道最初の宿場町品川宿の歴史が残る。下町的な商店街や寺社が各所にあり古今融和した文化。",
        "livability": "品川駅周辺は企業本社ビルが林立するオフィス街。住宅地は庶民的エリアもあり家賃中程度。新幹線停車駅で交通至便。オフィス街と住宅街の顔を持ち、地域コミュニティは駅周辺の商店街を中心に発達。"
    },
    "目黒区": {
        "medical_childcare": "緑地や坂が多く閑静で空気もきれい。区立病院あり地域医療は安定。",
        "education_culture": "高級住宅街が多く著名人も多く居住するお洒落な街。カフェやレストランなど洗練された文化。",
        "livability": "大規模商業地は少なく住宅地中心。家賃・地価は23区内でも高水準。治安良好で子育て世帯にも人気。車やタクシー移動が多く、落ち着いた大人のコミュニティが形成。"
    },
    "大田区": {
        "medical_childcare": "区内に羽田空港を抱え救急医療も整備。多摩川沿いの緑地や海浜公園など環境多様。",
        "education_culture": "銭湯文化が根付く庶民的地域。田園調布など高級住宅地も有し地区ごとに異なる文化色がある。",
        "livability": "中小工場が多い伝統的工業の街。空港関連産業や商店街も盛んで物価は23区内では安い。23区最大面積で地域差大。外部から地味と言われるが生活コスト安めで、地元密着の穏やかなコミュニティ。"
    },
    "世田谷区": {
        "medical_childcare": "区立病院や大学病院など医療機関多数。砧公園など広大な公園も多く環境良好。",
        "education_culture": "古くからの住宅街で文化人も多く居住。下北沢は音楽・演劇など若者文化の発信地。歴史的寺社も点在。",
        "livability": "人口約93万で全国最多級。商業施設は各副都心に分散。住宅街広くミドルクラス以上多数。地域により雰囲気が異なるが全体に治安良好。地域行事や子育て支援が盛んでファミリーに優しい街。"
    },
    "渋谷区": {
        "medical_childcare": "慶應病院や東京医療センターなど大型医療施設が複数。代々木公園など大規模緑地も所在。",
        "education_culture": "若者文化の中心地（渋谷・原宿）。一方、松濤・代官山など高級住宅街も抱え新旧文化が混在。",
        "livability": "ITベンチャー集積地「ビットバレー」で経済活発。繁華街・商業施設が集中し家賃・物価は最高水準。常に人出が多くイベント時は混雑、治安面で課題も。地区により住民層が異なり、恵比寿などは大人に人気で落ち着きあり。"
    },
    "中野区": {
        "medical_childcare": "中～小規模病院やクリニック中心。新宿に近いが閑静な住宅街に街路樹もあり、緑は程よく点在。",
        "education_culture": "芸人やクリエイターが多く住みライブハウスやサブカルの聖地中野ブロードウェイがある。",
        "livability": "新宿へのアクセス抜群でベッドタウンとして発展。商店街と安価な飲食店が多く家賃も比較的手頃。若者の一人暮らしが多く活気ある雰囲気。住民の距離感は程よく、新宿近接の利便性で人気。"
    },
    "杉並区": {
        "medical_childcare": "区内に病院多数。善福寺公園など緑地豊富。都心から程よい距離で空気も比較的きれい。",
        "education_culture": "高円寺は古着・音楽など若者サブカルの街として有名。阿佐ヶ谷の七夕祭り等、地域行事も盛ん。",
        "livability": "大規模住宅街が広がり、駅前に商店街・スーパーが揃う「暮らしの街」。都心寄りの割に家賃安め。閑静な住宅街が多く治安安定。都心から少し離れ広めの住居を確保しやすく、ファミリーにも人気。"
    },
    "豊島区": {
        "medical_childcare": "池袋周辺に病院が集中。目白の森など小規模緑地あり。都心部の割に医療資源は豊富。",
        "education_culture": "サブカルの街池袋を擁し何でも揃う一方、繁華街の治安は課題あり。巣鴨は高齢者の原宿と呼ばれる独自文化。",
        "livability": "池袋の商業規模は新宿・渋谷に次ぐ。物価中程度。羽田・成田や新幹線へのアクセスはやや不便。都心への近さと家賃のバランス良く単身者多数。池袋から離れると閑静な住宅街で、地域により住環境が大きく異なる。"
    },
    "北区": {
        "medical_childcare": "地域中核病院あり。飛鳥山公園など憩いの場充実。埼玉県境に近く自然も身近。",
        "education_culture": "王子や十条は下町的雰囲気。赤羽の飲み屋街が有名で昼間から飲む人も。古くは工業地帯で産業遺産も。",
        "livability": "京浜東北線沿線のベッドタウン。都心寄りより家賃低め。団地やマンションが多く住宅供給豊富。ファミリー層が多い団地・マンション街。赤羽では昼飲み文化が見られる庶民的で開放的な雰囲気。通勤ラッシュはやや心配。"
    },
    "荒川区": {
        "medical_childcare": "下町の医院が地域医療を支える。隅田川と荒川に挟まれ、水辺の緑地も点在。",
        "education_culture": "三ノ輪・南千住など江戸の風情を残す下町住宅街。昔ながらの商店と職人文化が今も残る。",
        "livability": "山手線内側にも関わらず家賃が安く穴場。大企業は少ないが中小企業や町工場が健在。昔からの住民が多く人情味あり。都心通勤に便利で近年若い世帯も流入しつつある。"
    },
    "板橋区": {
        "medical_childcare": "地域中核病院あり。光が丘公園等の大規模緑地が近接し緑の恩恵。",
        "education_culture": "中山道の宿場町由来。「23区じゃなく埼玉だろ」と冗談で言われる郊外イメージ。地味だが庶民文化が根強い。",
        "livability": "郊外型の住宅地でスーパーやチェーン店多数。物価・家賃安めで学生から家族まで住みやすい。ファミリー層と単身学生が混在する庶民の街。高級感こそないが安全で暮らしやすい。地元愛着の強い住民も多い。"
    },
    "練馬区": {
        "medical_childcare": "23区最大級の農地面積を持ち新鮮な地場野菜が手に入る。光が丘団地など計画的緑地も広い。",
        "education_culture": "戦後開けた新興住宅地が多く伝統文化は薄めだが、東映アニメ発祥地でアニメの街としての一面もある。",
        "livability": "農地が多く東京らしさが薄いとの声も。都心への鉄道はあるが新幹線・空港アクセスにやや不便。大規模団地が有名でファミリー向け住宅多い。防犯パトロールなど行政の安全対策に注力し、落ち着いた暮らしやすい街。"
    },
    "足立区": {
        "medical_childcare": "北部医療センター等が中核。荒川河川敷など広大な緑地あり運動施設充実。",
        "education_culture": "下町人情が厚く祭りやイベントも盛ん。漫画『こち亀』両さんの実家がある（設定上隣区とのネタ）。",
        "livability": "家賃が23区で最安水準。北千住は交通結節点で都心東部へのアクセス良好。かつて治安面の偏見もあったが現在は改善傾向で「実は良好」との声も。大型商業施設が増え買物便利、子育て支援も充実。"
    },
    "葛飾区": {
        "medical_childcare": "下町の医院や区民施設が充実。江戸川河川敷など自然も多く、健康増進に寄与する施設も整備。",
        "education_culture": "柴又帝釈天と寅さん、亀有の両さん（こち亀）など人情味あふれる下町の象徴。",
        "livability": "中小工場の集積地で「産業のまち」。物価安く庶民的商店街が充実し生活コスト低い。近所付き合いが濃密。外部から茶化されることもあるが住民は誇りを持ち助け合う良きコミュニティ。"
    },
    "江戸川区": {
        "medical_childcare": "水と緑が豊富（葛西臨海公園や親水公園多数）で環境良好。子育て医療支援手厚い。",
        "education_culture": "高度成長期以降に開けた住宅地中心で文化財は少ないが、地域祭りや盆踊りなどコミュニティ文化が根強い。",
        "livability": "23区東端で物価・地価が比較的低め。千葉県境でディズニーランドに行きやすい立地。若いファミリーが多く活気ある街。「独身を卒業したら住みたい街」とも評される子育て人気エリア。防災・防犯にも地域ぐるみで積極的。"
    }
}

async def update_area_characteristics():
    """各区の特徴データを更新"""
    # MongoDB接続
    MONGODB_URL = os.getenv("MONGODB_URL", "mongodb://localhost:27017")
    client = AsyncIOMotorClient(
        MONGODB_URL,
        tlsAllowInvalidCertificates=True
    )
    
    # Beanie初期化
    await init_beanie(
        database=client.tokyo_wellbeing,
        document_models=[Area]
    )
    
    print("特徴データの更新を開始します...")
    
    # 各区のデータを更新
    updated_count = 0
    for area_name, characteristics in AREA_CHARACTERISTICS.items():
        # 区を検索
        area = await Area.find_one(Area.name == area_name)
        
        if area:
            # 特徴データを作成
            area_char = AreaCharacteristics(**characteristics)
            
            # 区のデータを更新
            area.characteristics = area_char
            await area.save()
            
            print(f"✓ {area_name}の特徴データを更新しました")
            updated_count += 1
        else:
            print(f"✗ {area_name}が見つかりませんでした")
    
    print(f"\n完了: {updated_count}区の特徴データを更新しました")
    
    # 確認のため、いくつかのデータを表示
    print("\n=== 更新されたデータの確認 ===")
    sample_areas = ["千代田区", "新宿区", "世田谷区"]
    
    for area_name in sample_areas:
        area = await Area.find_one(Area.name == area_name)
        if area and area.characteristics:
            print(f"\n{area_name}:")
            print(f"  医療・子育て: {area.characteristics.medical_childcare[:50]}...")
            print(f"  教育・文化: {area.characteristics.education_culture[:50]}...")
            print(f"  暮らしやすさ: {area.characteristics.livability[:50]}...")

if __name__ == "__main__":
    asyncio.run(update_area_characteristics())