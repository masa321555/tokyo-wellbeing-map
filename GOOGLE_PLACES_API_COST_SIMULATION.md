# Google Places API 料金シミュレーション

## 前提条件
- 都庁主催のハッカソン向けツール
- 利用者数：限定的（審査員・関係者のみ）
- 東京23区のレジャー施設データを取得

## Google Places API の料金体系（2025年8月時点）

### 無料枠
- **月額$200分のクレジット**が毎月付与される
- 約28,500リクエスト分に相当

### API料金詳細

| APIタイプ | 料金（1,000リクエストあたり） | 無料枠での利用可能回数 |
|---------|--------------------------|-------------------|
| Places Search (Basic) | $17.00 | 約11,700回 |
| Places Details (Basic) | $17.00 | 約11,700回 |
| Places Nearby Search | $32.00 | 約6,250回 |
| Place Photos | $7.00 | 約28,500回 |

## 使用シナリオ別の料金シミュレーション

### シナリオ1：初期データ取得のみ（推奨）
**方法**：アプリ起動時に一度だけ全区のデータを取得し、データベースに保存

**必要なAPIコール数**：
- 23区 × 4種類の施設（映画館、テーマパーク、ショッピングモール、ゲームセンター）
- = 92回のPlaces Search

**月額費用**：
- 92リクエスト × $0.017 = **$1.56（約234円）**
- **無料枠内で完全に収まる**

### シナリオ2：リアルタイム検索（ユーザーアクセス毎）
**想定利用者数**：50人（審査員・関係者）
**一人あたりの操作**：
- 5つの区を詳細表示
- 3回の検索実行

**必要なAPIコール数**：
- 50人 × 5区 × 4施設種類 = 1,000回
- 50人 × 3検索 × 23区 × 4施設種類 = 13,800回
- 合計：14,800回

**月額費用**：
- 14,800リクエスト × $0.017 = **$251.60（約37,740円）**
- 無料枠を超過：$51.60（約7,740円）の課金

### シナリオ3：定期更新バッチ処理
**方法**：週1回、全データを更新

**必要なAPIコール数**：
- 23区 × 4施設種類 × 4週 = 368回/月

**月額費用**：
- 368リクエスト × $0.017 = **$6.26（約939円）**
- **無料枠内で完全に収まる**

## 推奨実装方式

### 1. **ハイブリッド方式（最も現実的）**
```python
# 実装例
class LeisureFacilityService:
    def __init__(self):
        self.cache_duration = timedelta(days=7)  # 1週間キャッシュ
    
    async def get_facilities(self, area_code: str):
        # DBから取得を試みる
        cached_data = await self.get_from_cache(area_code)
        
        if cached_data and not self.is_expired(cached_data):
            return cached_data
        
        # キャッシュがない or 期限切れの場合のみAPIを呼ぶ
        fresh_data = await self.fetch_from_google_places(area_code)
        await self.save_to_cache(area_code, fresh_data)
        return fresh_data
```

**予想月額費用**：
- 初回：92回（全区データ取得）
- 更新：週1回 × 更新が必要な区のみ（約20回）
- **合計：約112回 = $1.90（約285円）**
- **完全に無料枠内**

### 2. **コスト削減のテクニック**

1. **Fields パラメータの活用**
   ```python
   # 必要なフィールドのみ取得してコスト削減
   results = gmaps.places(
       query=f"{area_name} 映画館",
       fields=['name', 'geometry', 'place_id']  # 最小限のフィールド
   )
   ```

2. **バッチ処理の最適化**
   - 夜間に一括更新
   - 変更があった区のみ更新

3. **フロントエンドでのキャッシュ**
   ```typescript
   // LocalStorageでクライアント側キャッシュ
   const CACHE_KEY = 'leisure_facilities';
   const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24時間
   ```

## 結論

**ハッカソン用途であれば、Google Places APIは実質無料で利用可能です。**

推奨構成：
1. 初期データ取得：$1.56
2. 週次更新：$1.00程度
3. 月額合計：**$3～5（450～750円）程度**

これは月額$200の無料枠の**2.5%程度**の使用量で、完全に無料枠内で運用可能です。

## 実装時の注意点

1. **APIキーの制限設定**
   - HTTPリファラー制限
   - APIの使用制限設定
   - 月額上限アラートの設定

2. **エラーハンドリング**
   - レート制限対策
   - フォールバック（キャッシュデータの利用）

3. **セキュリティ**
   - APIキーは環境変数で管理
   - フロントエンドには露出させない