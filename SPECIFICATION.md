# 東京ウェルビーイング 仕様書

最終更新日: 2025年8月22日

## 1. アプリケーション概要

### 1.1 プロジェクト名
東京ウェルビーイング (Tokyo Wellbeing )

### 1.2 目的
東京23区における子育て世帯の居住地選びを支援するWebアプリケーション。
各区の住環境、教育、医療、治安などの多面的なデータを可視化し、家族のニーズに合った地域選択を支援する。

### 1.3 主要な特徴
- 23区の詳細な地域情報を一元化
- ウェルビーイング指標による定量的評価
- 家計シミュレーション機能
- リアルタイム混雑度情報
- カスタマイズ可能な重み付けによるランキング

## 2. 機能と概要

### 2.1 エリア詳細表示機能
各区の詳細情報を以下のカテゴリで表示：

#### 2.1.1 基本情報
- 人口・世帯数
- 面積・人口密度
- 年齢層別人口分布

#### 2.1.2 住宅情報
- 間取り別家賃相場（1R〜3LDK）
- 空き家率

#### 2.1.3 教育・子育て環境
- 小中高等学校数
- 保育園・幼稚園数
- 待機児童数
- 子育て支援制度一覧

#### 2.1.4 公園・緑地
- 公園総数
- 一人当たり公園面積
- 大規模公園数

#### 2.1.5 治安・安全
- 犯罪率（人口千人当たり）
- 警察署・交番数
- 消防署数

#### 2.1.6 医療・福祉
- 病院・診療所数
- 医師数（人口千人当たり）
- 救急病院数

#### 2.1.7 文化・レジャー施設
- 図書館・美術館・博物館数
- スポーツ施設数
- 映画館・ショッピングモール数

### 2.2 ウェルビーイングスコア算出機能
- **概要**: 6つのカテゴリの重み付け平均でスコアを算出
- **カテゴリ**:
  - 家賃 (rent)
  - 治安 (safety)
  - 教育 (education)
  - 公園 (parks)
  - 医療 (medical)
  - 文化 (culture)
- **算出方法**: 各指標を0-100に正規化し、ユーザー設定の重みで加重平均

### 2.3 検索・フィルタリング機能
- 家賃範囲での絞り込み
- 間取りタイプ選択
- 特定条件（待機児童ゼロ、大規模公園あり等）でのフィルタリング
- ソート機能（スコア順、家賃順等）

### 2.4 エリア比較機能
- 最大3区の並列比較
- レーダーチャート表示
- 各指標の数値比較表

### 2.5 家計シミュレーション機能
- **入力項目**:
  - 世帯構成（大人・子供の人数）
  - 世帯年収
  - 希望間取り
  - 通勤先
  - 車所有の有無
- **出力結果**:
  - 月間支出内訳（円グラフ）
  - 年間総支出
  - 可処分所得
  - 貯蓄率
  - 住居費負担度

### 2.6 混雑度情報表示
- 時間帯別混雑度
- 施設種別混雑度
- 家族向け指標

### 2.7 ゴミ分別情報
- 分別カテゴリ一覧
- 収集曜日
- 特別ルール
- 分別の厳格度レベル

### 2.8 町名・駅情報表示
- 区内の全町名リスト
- 最寄り駅と路線情報
- 駅までの距離

## 3. データソースと取得情報

### 3.1 東京都オープンデータカタログサイト
**URL**: https://catalog.data.metro.tokyo.lg.jp/

#### 3.1.1 人口・世帯データ
- **データセット**: 住民基本台帳による世帯と人口
- **取得情報**:
  - 区別人口（総数・男女別）
  - 世帯数
  - 人口密度
- **更新頻度**: 毎月
- **データ形式**: CSV/JSON

#### 3.1.2 年齢層別人口データ
- **データセット**: 住民基本台帳による年齢階級別人口
- **取得情報**:
  - 5歳階級別人口（0-4歳、5-9歳...75歳以上）
  - 3区分人口（年少・生産年齢・老年人口）
- **参照元**: `tokyo_age_population_ckan_simple.json`

#### 3.1.3 子育て支援制度データ
- **データセット**: 子育て支援制度レジストリ
- **取得情報**:
  - 制度名称・概要
  - 金銭的支援内容
  - 物品支援内容
  - 対象者条件
- **データ形式**: JSON
- **参照元**: `childcare_support_23wards.json`

### 3.2 東京都総務局統計部
**URL**: https://www.toukei.metro.tokyo.lg.jp/

#### 3.2.1 基礎自治体データ
- **取得情報**:
  - 区の面積（km²）
  - 区役所所在地（緯度・経度）
- **更新時期**: 令和6年4月1日現在

### 3.3 内部管理データ

#### 3.3.1 住宅データ
- **管理ファイル**: `init_mongo_simple.py`内のhousing_data
- **情報内容**:
  - 間取り別家賃相場（1R、1K、1DK、1LDK、2LDK、3LDK）
  - 空き家率
- **データソース**: 不動産情報サイトの統計データを基に作成

#### 3.3.2 教育施設データ
- **管理方法**: MongoDBコレクション
- **情報内容**:
  - 小学校・中学校・高等学校数
  - 図書館数
- **データソース**: 各区教育委員会公表データ

#### 3.3.3 保育・子育て施設データ
- **情報内容**:
  - 認可保育園数
  - 幼稚園数
  - 待機児童数
  - 子育て支援センター数

#### 3.3.4 公園データ
- **情報内容**:
  - 公園総数
  - 総面積（m²）
  - 一人当たり公園面積
  - 大規模公園数

#### 3.3.5 治安データ
- **情報内容**:
  - 犯罪件数・犯罪率
  - 警察署・交番数
  - 防犯カメラ設置数
- **データソース**: 警視庁犯罪統計

#### 3.3.6 医療データ
- **情報内容**:
  - 病院・診療所数
  - 人口千人当たり医師数
  - 救急指定病院数

#### 3.3.7 文化・レジャー施設データ
- **情報内容**:
  - 図書館・美術館・博物館数
  - スポーツ施設数
  - 映画館・テーマパーク数
  - ショッピングモール・ゲームセンター数

#### 3.3.8 区の特徴テキストデータ
- **管理ファイル**: `import_area_characteristics.py`
- **情報内容**:
  - 医療・子育て環境の特徴
  - 教育・文化の特徴
  - 暮らしやすさの特徴

#### 3.3.9 町名・駅情報データ
- **管理ファイル**: 各種CSVファイル
- **主要ファイル**:
  - `tokyo_townlist_with_stations_absolute_final.csv`
  - `tokyo_area_place_names.csv`
- **情報内容**:
  - 区内全町名リスト
  - 最寄り駅情報
  - 路線情報
  - 駅までの距離

#### 3.3.10 ゴミ分別ルールデータ
- **管理ファイル**: `waste_separation_rules.py`
- **情報内容**:
  - 分別カテゴリ
  - 収集曜日
  - 特別ルール
  - 分別厳格度（1-5段階）

## 4. 連携しているAPI

### 4.1 内部API (FastAPI)
**ベースURL**: https://tokyo-wellbeing-map-api-mongo.onrender.com

#### 4.1.1 エリア関連API
- `GET /api/v1/areas/` - 全エリア一覧取得
- `GET /api/v1/areas/{area_id}` - エリア詳細取得
- `POST /api/v1/areas/compare` - エリア比較

#### 4.1.2 ウェルビーイング関連API
- `POST /api/v1/wellbeing/calculate/` - スコア計算
- `POST /api/v1/wellbeing/ranking/` - ランキング取得
- `GET /api/v1/wellbeing/weights/presets/` - プリセット重み取得

#### 4.1.3 検索API
- `POST /api/v1/search/` - 条件検索

#### 4.1.4 シミュレーションAPI
- `POST /api/v1/simulation/household/` - 家計シミュレーション

#### 4.1.5 混雑度API
- `GET /api/v1/congestion/area/{area_id}/` - エリア混雑度取得

### 4.2 外部API

#### 4.2.1 Google Places API
- **用途**: リアルタイム混雑度情報の取得（実装準備中）
- **エンドポイント**: Place Details API
- **取得情報**:
  - 現在の混雑度
  - 通常時の混雑度パターン
  - 滞在時間の目安

#### 4.2.2 東京都オープンデータカタログAPI (CKAN)
- **用途**: 最新の統計データ自動取得
- **プロトコル**: CKAN API v3
- **主要エンドポイント**:
  - `/api/3/action/package_show` - データセット情報取得
  - `/api/3/action/resource_show` - リソース詳細取得

## 5. 活用している東京都のオープンデータ

### 5.1 人口統計関連
1. **住民基本台帳による世帯と人口**
   - データセットID: jy24qf0601
   - 形式: Excel/CSV
   - 内容: 月次の区市町村別人口・世帯数

2. **年齢階級別人口**
   - データセットID: jy25rf0901
   - 形式: Excel/CSV
   - 内容: 5歳階級別の詳細な人口構成

### 5.2 子育て支援関連
1. **子育て支援制度レジストリ**
   - 形式: JSON
   - 内容: 23区の子育て支援制度詳細
   - 項目: 制度名、支援内容、対象者、申請方法等

### 5.3 インフラ・施設関連
1. **公共施設一覧**（計画中）
   - 図書館、スポーツ施設等の位置情報
   - 利用条件、開館時間等

## 6. ウェルビーイングスコア集計ロジック詳細

### 6.1 スコア計算の基本構造
ウェルビーイングスコアは、6つのカテゴリスコアの重み付け平均として算出されます。

```
総合スコア = Σ(カテゴリスコア × カテゴリ重み)
```

### 6.2 各カテゴリのスコア計算ロジック

#### 6.2.1 家賃スコア (Rent Score)
- **基本計算式**: `スコア = 100 × (1 - 家賃 / 最大値)`
- **最大値設定**: 30万円
- **使用データ**: 2LDKの平均家賃
- **特徴**: 家賃が安いほど高スコア
- **オプション**: ターゲット家賃設定時は、目標値との差分で計算
  ```
  差分率 = |実際の家賃 - ターゲット家賃| / ターゲット家賃
  スコア = 100 × (1 - 差分率)
  ```

#### 6.2.2 治安スコア (Safety Score)
- **基本計算式**: `基本スコア = 100 × (1 - 犯罪率 / 最大値)`
- **最大値設定**: 犯罪率20.0（人口千人当たり）
- **補正要素**:
  1. **警察署ボーナス**: 最大5点（警察署数 / 10）
  2. **災害リスクペナルティ**: 最大10点（(リスクスコア - 1) × 3.33）
  3. **繁華街ペナルティ**: 区ごとに設定（0～15点）
     - 新宿区: 15点（歌舞伎町など）
     - 渋谷区: 12点（センター街など）
     - 豊島区: 10点（池袋西口など）
     - 台東区: 8点（上野・浅草の夜の街）
     - 港区: 8点（六本木など）
     - その他: 0～5点
- **最終計算**: `最終スコア = 基本スコア + 警察署ボーナス - 災害リスクペナルティ - 繁華街ペナルティ`

#### 6.2.3 教育スコア (Education Score)
- **基本計算式**: `基本スコア = 100 × (小中学校数合計 / 最大値)`
- **最大値設定**: 50校
- **補正要素**:
  - **待機児童ペナルティ**: 最大30点
    ```
    ペナルティ = 30 × (待機児童数 / 300)
    ```
- **最終計算**: `最終スコア = 基本スコア - 待機児童ペナルティ`

#### 6.2.4 公園スコア (Parks Score)
- **計算式**: `スコア = 100 × (公園総数 / 最大値)`
- **最大値設定**: 100箇所
- **使用データ**: 区内の公園総数

#### 6.2.5 医療スコア (Medical Score)
- **計算式**: `スコア = 100 × (病院数 / 最大値)`
- **最大値設定**: 20施設
- **使用データ**: 病院数（診療所は含まない）

#### 6.2.6 文化スコア (Culture Score)
- **計算式**: `スコア = 100 × (図書館数 / 最大値)`
- **最大値設定**: 10施設
- **使用データ**: 図書館数

### 6.3 重み付けシステム

#### 6.3.1 デフォルト重み
- 家賃: 0.25 (25%)
- 治安: 0.20 (20%)
- 教育: 0.20 (20%)
- 公園: 0.15 (15%)
- 医療: 0.10 (10%)
- 文化: 0.10 (10%)

#### 6.3.2 重みの正規化
ユーザーが設定した重みは自動的に正規化され、合計が1.0（100%）になります。
```python
正規化後の重み = 各重み / 全重みの合計
```

#### 6.3.3 プリセット重み設定
- **子育て重視型**: 教育30%、公園25%、治安20%、医療15%、家賃5%、文化5%
- **コスト重視型**: 家賃40%、治安20%、教育20%、公園10%、医療5%、文化5%
- **シニア向け**: 医療30%、治安25%、公園20%、文化15%、家賃5%、教育5%

### 6.4 スコアの特徴と制限

#### 6.4.1 スコア範囲
- 各カテゴリスコア: 0～100点
- 総合スコア: 0～100点

#### 6.4.2 データ欠損時の処理
- データが存在しない場合: デフォルトスコア50点を付与
- 部分的なデータ欠損: 利用可能なデータのみで計算

#### 6.4.3 外れ値の処理
- 最大値を超える場合: 100点でキャップ
- 負の値になる場合: 0点でフロア

### 6.5 スコア計算の実装例

```python
# 総合スコア計算の実装
def calculate_total_score(area, weights):
    # 各カテゴリスコアを計算
    scores = {
        'rent': calculate_rent_score(area),
        'safety': calculate_safety_score(area),
        'education': calculate_education_score(area),
        'parks': calculate_parks_score(area),
        'medical': calculate_medical_score(area),
        'culture': calculate_culture_score(area)
    }
    
    # 重み付け平均を計算
    total_score = sum(
        scores[category] * weight 
        for category, weight in weights.items()
    )
    
    return round(total_score, 2)
```

### 6.6 今後の改善計画

#### 6.6.1 スコア計算の精緻化
- 人口密度を考慮した施設数の正規化
- 時系列データを用いたトレンド分析
- 機械学習による重み最適化

#### 6.6.2 新規指標の追加
- 交通利便性スコア
- 商業施設充実度スコア
- コミュニティ活性度スコア

## 7. 技術スタック

### 7.1 フロントエンド
- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS v3
- **状態管理**: Zustand
- **グラフ**: Recharts
- **HTTPクライアント**: Axios

### 7.2 バックエンド
- **フレームワーク**: FastAPI
- **言語**: Python 3.11
- **データベース**: MongoDB
- **ODM**: Beanie
- **非同期処理**: asyncio
- **バリデーション**: Pydantic

### 7.3 インフラ
- **フロントエンドホスティング**: Vercel
- **バックエンドホスティング**: Render
- **データベース**: MongoDB (ローカル) / MongoDB Atlas (本番予定)

## 8. データ更新とメンテナンス

### 8.1 自動更新対象
- 人口統計データ（月次）
- 混雑度情報（リアルタイム）

### 8.2 手動更新対象
- 家賃相場データ（四半期）
- 施設数データ（年次）
- 区の特徴テキスト（必要に応じて）

### 8.3 データ品質管理
- 入力データのバリデーション
- 異常値の検出と通知
- 更新履歴の記録

## 9. セキュリティとプライバシー

### 9.1 データ保護
- 個人情報は一切収集・保存しない
- シミュレーション入力値はセッション内のみ保持

### 9.2 API保護
- CORS設定による不正アクセス防止
- レート制限の実装（計画中）

## 10. 今後の拡張計画

### 10.1 機能拡張
- Google Places APIによるリアルタイム混雑度表示
- 通勤時間シミュレーション
- 災害リスク情報の追加
- 多言語対応（英語・中国語・韓国語）

### 10.2 データ拡張
- 商業施設の詳細情報
- 交通アクセス情報の充実
- 不動産価格トレンド

### 10.3 UX改善
- モバイル最適化
- パフォーマンス向上
- アクセシビリティ対応

## 11. 参考資料・リンク

- [東京都オープンデータカタログ](https://catalog.data.metro.tokyo.lg.jp/)
- [東京都の統計](https://www.toukei.metro.tokyo.lg.jp/)
- [警視庁犯罪統計](https://www.keishicho.metro.tokyo.jp/about_mpd/jokyo_tokei/index.html)
- [プロジェクトGitHubリポジトリ](https://github.com/masa321555/tokyo-wellbeing-map)

---

本仕様書は開発の進捗に応じて適宜更新されます。